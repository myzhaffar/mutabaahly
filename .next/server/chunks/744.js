"use strict";exports.id=744,exports.ids=[744],exports.modules={23973:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(33592).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},47340:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(33592).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},63795:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(33592).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},83917:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(33592).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},92551:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(33592).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},53736:(e,s,t)=>{t.a(e,async(e,a)=>{try{t.d(s,{Z:()=>f});var r=t(20997),l=t(16689),n=t(37435),i=t(95364),d=t(20362),c=t(87095),o=t(7825),h=t(36460),u=t(70550),m=t(12987),p=t(32581),x=t(88055),g=t(15659),j=t(49175),y=e([n,i,d,c,o,p,g]);[n,i,d,c,o,p,g]=y.then?(await y)():y;let f=({onStudentAdded:e})=>{let[s,t]=(0,l.useState)(!1),[a,y]=(0,l.useState)(!1),[f,v]=(0,l.useState)(null),[N,w]=(0,l.useState)({name:"",group_name:"",teacher:""}),{toast:b}=(0,m.pm)(),{profile:C}=(0,x.a)();if(C?.role!=="teacher")return null;let S=async e=>{try{let s=e.name.split(".").pop(),t=`${Date.now()}-${Math.random()}.${s}`,a=`student-photos/${t}`,{error:r}=await u.O.storage.from("student-photos").upload(a,e);if(r)throw r;let{data:l}=u.O.storage.from("student-photos").getPublicUrl(a);return l.publicUrl}catch(e){return console.error("Error uploading image:",e),null}},_=async s=>{if(s.preventDefault(),C?.role!=="teacher"){b({title:"Error",description:"You don't have permission to add students.",variant:"destructive"});return}y(!0);try{let s=null;if(f&&!(s=await S(f)))throw Error("Failed to upload image");let{error:a}=await u.O.from("students").insert([{...N,photo:s}]);if(a)throw a;b({title:"Success",description:"Student added successfully!"}),w({name:"",group_name:"",teacher:""}),v(null),t(!1),e()}catch(e){console.error("Error adding student:",e),b({title:"Error",description:"Failed to add student. Please try again.",variant:"destructive"})}finally{y(!1)}},k=(e,s)=>{w(t=>({...t,[e]:s}))};return(0,r.jsxs)(n.Vq,{open:s,onOpenChange:t,children:[r.jsx(n.hg,{asChild:!0,children:(0,r.jsxs)(d.O,{children:[r.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"Add Student"]})}),(0,r.jsxs)(n.cZ,{className:"sm:max-w-[425px]","aria-describedby":"add-student-description",children:[(0,r.jsxs)(n.fK,{children:[r.jsx(n.$N,{children:"Add Student"}),r.jsx(n.Be,{id:"add-student-description",children:"Fill in the details to add a new student."})]}),(0,r.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o._,{htmlFor:"photo",children:"Profile Photo"}),r.jsx(p.Z,{onFileSelect:v})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o._,{htmlFor:"name",children:"Student Name"}),r.jsx(c.I,{id:"name",value:N.name,onChange:e=>k("name",e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o._,{htmlFor:"group_name",children:"Group/Class"}),r.jsx(c.I,{id:"group_name",value:N.group_name,onChange:e=>k("group_name",e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o._,{htmlFor:"teacher",children:"Teacher"}),(0,r.jsxs)(g.Ph,{value:N.teacher,onValueChange:e=>k("teacher",e),required:!0,children:[r.jsx(g.i4,{className:"w-full",children:r.jsx(g.ki,{placeholder:"Select teacher"})}),r.jsx(g.Bw,{children:j.LQ.map(e=>r.jsx(g.Ql,{value:e.name,children:e.name},e.id))})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[r.jsx(i.z,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),r.jsx(d.O,{type:"submit",disabled:a,children:a?"Adding...":"Add Student"})]})]})]})]})};a()}catch(e){a(e)}})},41919:(e,s,t)=>{t.a(e,async(e,a)=>{try{t.d(s,{Z:()=>S});var r=t(20997),l=t(16689),n=t(37435),i=t(95364),d=t(20362),c=t(7825),o=t(6391),h=t(63795),u=t(83917),m=t(22972),p=t(23973),x=t(47340),g=t(92551),j=t(70550),y=t(12987),f=t(88055),v=t(49175),N=t(6302),w=t(57153),b=t.n(w),C=e([n,i,d,c]);[n,i,d,c]=C.then?(await C)():C;let S=({onStudentsAdded:e})=>{let[s,t]=(0,l.useState)(!1),[a,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)(null),[_,k]=(0,l.useState)([]),[Z,E]=(0,l.useState)([]),[F,B]=(0,l.useState)({current:0,total:0,success:0,failed:0}),{toast:z}=(0,y.pm)(),{profile:P}=(0,f.a)();if(P?.role!=="teacher")return null;let $=(e,s=1)=>{let t=[];return e.forEach((e,a)=>{let r=s+a;e.name&&0!==e.name.trim().length?e.name.trim().length<2&&t.push({row:r,field:"name",message:"Student name must be at least 2 characters long"}):t.push({row:r,field:"name",message:"Student name is required"}),e.group_name&&0!==e.group_name.trim().length||t.push({row:r,field:"group_name",message:"Group/Class is required"}),e.teacher&&0!==e.teacher.trim().length?v.LQ.some(s=>s.name===e.teacher.trim())||t.push({row:r,field:"teacher",message:`Teacher "${e.teacher}" not found in the system`}):t.push({row:r,field:"teacher",message:"Teacher is required"})}),t},q=async e=>{try{let s=e.name.split(".").pop()?.toLowerCase(),t=[];if("csv"===s){let s=await e.text(),a=b().parse(s,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim().toLowerCase().replace(/\s+/g,"_")});if(a.errors.length>0)throw Error(`CSV parsing errors: ${a.errors.map(e=>e.message).join(", ")}`);t=a.data}else if(["xlsx","xls"].includes(s||"")){let s=await e.arrayBuffer(),a=N.read(s,{type:"array"}),r=a.SheetNames[0],l=a.Sheets[r],n=N.utils.sheet_to_json(l,{header:1});if(n.length<2)throw Error("Excel file must have at least a header row and one data row");let i=n[0].map(e=>e?.toString().toLowerCase().replace(/\s+/g,"_"));t=n.slice(1).map(e=>{let s={};return i.forEach((t,a)=>{void 0!==e[a]&&null!==e[a]&&(s[t]=e[a].toString().trim())}),{name:s.name||"",group_name:s.group_name||"",teacher:s.teacher||"",grade:s.grade}})}else throw Error("Unsupported file format. Please upload a CSV or Excel file.");let a=$(t,2);E(a),k(t),a.length>0?z({title:"Validation Errors",description:`Found ${a.length} validation errors. Please fix them before uploading.`,variant:"destructive"}):z({title:"File Processed",description:`Successfully processed ${t.length} students. Ready to upload.`})}catch(e){console.error("Error processing file:",e),z({title:"Error",description:e instanceof Error?e.message:"Failed to process file",variant:"destructive"})}},U=async()=>{if(C&&0!==_.length&&!(Z.length>0)){w(!0),B({current:0,total:_.length,success:0,failed:0});try{let s=_.map(e=>({name:e.name.trim(),group_name:e.group_name.trim(),teacher:e.teacher.trim(),grade:e.grade?.trim()||null})),a=0,r=0;for(let e=0;e<s.length;e+=10){let t=s.slice(e,e+10),{error:l}=await j.O.from("students").insert(t);l?(console.error("Error inserting batch:",l),r+=t.length):a+=t.length,B(s=>({...s,current:e+t.length,success:a,failed:r}))}a>0?(z({title:"Upload Complete",description:`Successfully added ${a} students${r>0?`, ${r} failed`:""}.`}),t(!1),e()):z({title:"Upload Failed",description:"Failed to add any students. Please try again.",variant:"destructive"})}catch(e){console.error("Error uploading students:",e),z({title:"Error",description:"Failed to upload students. Please try again.",variant:"destructive"})}finally{w(!1)}}};return(0,r.jsxs)(n.Vq,{open:s,onOpenChange:t,children:[r.jsx(n.hg,{asChild:!0,children:(0,r.jsxs)(i.z,{variant:"outline",className:"flex items-center gap-2",children:[r.jsx(o.Z,{className:"h-4 w-4"}),"Bulk Upload"]})}),(0,r.jsxs)(n.cZ,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[(0,r.jsxs)(n.fK,{children:[r.jsx(n.$N,{children:"Bulk Upload Students"}),r.jsx(n.Be,{children:"Upload an Excel or CSV file to add multiple students at once."})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(c._,{htmlFor:"file-input",children:"Upload File"}),(0,r.jsxs)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{let e=N.utils.json_to_sheet([{name:"Ahmad Ali",group_name:"Class A",teacher:"Pak Muzhaffar"},{name:"Fatima Zahra",group_name:"Class B",teacher:"Bu Titin"},{name:"Muhammad Hassan",group_name:"Class A",teacher:"Pak Heri"},{name:"Aisha Rahman",group_name:"Class C",teacher:"Bu Liana"},{name:"Yusuf Ibrahim",group_name:"Class B",teacher:"Bu Witri"}],{header:["name","group_name","teacher"]}),s=N.utils.book_new();N.utils.book_append_sheet(s,e,"Students Template"),N.writeFile(s,"students_template.xlsx")},className:"flex items-center gap-2",children:[r.jsx(h.Z,{className:"h-4 w-4"}),"Download Template"]})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("input",{id:"file-input",type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{let s=e.target.files?.[0];s&&(S(s),k([]),E([]),B({current:0,total:0,success:0,failed:0}),q(s))},className:"hidden"}),C?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(u.Z,{className:"h-8 w-8 mx-auto text-green-500"}),r.jsx("p",{className:"text-sm font-medium",children:C.name}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[(C.size/1024).toFixed(1)," KB"]}),(0,r.jsxs)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{S(null),k([]),E([]),B({current:0,total:0,success:0,failed:0});let e=document.getElementById("file-input");e&&(e.value="")},className:"flex items-center gap-2",children:[r.jsx(m.Z,{className:"h-4 w-4"}),"Remove File"]})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o.Z,{className:"h-8 w-8 mx-auto text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),r.jsx("p",{className:"text-xs text-gray-500",children:"CSV, XLSX, or XLS files only"}),r.jsx(i.z,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input")?.click(),children:"Choose File"})]})]})]}),Z.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[r.jsx(p.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{className:"font-medium",children:["Validation Errors (",Z.length,")"]})]}),(0,r.jsxs)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[Z.slice(0,5).map((e,s)=>(0,r.jsxs)("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:["Row ",e.row,": ",e.field," - ",e.message]},s)),Z.length>5&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["... and ",Z.length-5," more errors"]})]})]}),_.length>0&&0===Z.length&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[r.jsx(x.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{className:"font-medium",children:["Preview (",_.length," students)"]})]}),(0,r.jsxs)("div",{className:"max-h-32 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs font-medium text-gray-600 border-b pb-1",children:[r.jsx("div",{children:"Name"}),r.jsx("div",{children:"Group"}),r.jsx("div",{children:"Teacher"})]}),_.slice(0,5).map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs border-b py-1",children:[r.jsx("div",{children:e.name}),r.jsx("div",{children:e.group_name}),r.jsx("div",{children:e.teacher})]},s)),_.length>5&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 pt-1",children:["... and ",_.length-5," more students"]})]})]}),F.total>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{children:"Upload Progress"}),(0,r.jsxs)("span",{children:[F.current,"/",F.total]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${F.current/F.total*100}%`}})}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-600",children:[(0,r.jsxs)("span",{children:["Success: ",F.success]}),(0,r.jsxs)("span",{children:["Failed: ",F.failed]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[r.jsx(i.z,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:a,children:"Cancel"}),r.jsx(d.O,{type:"button",onClick:U,disabled:a||!C||0===_.length||Z.length>0,children:a?(0,r.jsxs)(r.Fragment,{children:[r.jsx(g.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):"Upload Students"})]})]})]})]})};a()}catch(e){a(e)}})}};