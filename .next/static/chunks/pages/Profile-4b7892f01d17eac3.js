(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9929],{89975:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Profile",function(){return l(80932)}])},46573:function(e,s,l){"use strict";l.d(s,{O:function(){return a}});let a=(0,l(56844).eI)("https://isyhakwwgdozgtlquzis.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzeWhha3d3Z2Rvemd0bHF1emlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NTY3NzcsImV4cCI6MjA2MjUzMjc3N30.-2Ya944q8mgJzRAuhMpRAWgxWVmt2yc3CqM0jjgFuuY",{db:{schema:"public"}})},80932:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return M}});var a=l(85893),r=l(67294),t=l(88055),i=l(50947),n=l(21427),c=l(88886),o=l(9464),d=l(97613),m=l(17911),x=l(33656),h=l(59911),u=l(3498),p=l(95364),j=l(39332),f=l(42964),g=l(1462),N=l(69750),v=e=>{let{children:s,breadcrumbs:l}=e,{profile:i,loading:n}=(0,t.a)(),c=(0,j.useRouter)(),[o,d]=r.useState(!1);return(r.useEffect(()=>{n||i||c.push("/auth")},[n,i,c]),n)?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-islamic-500"})}):i?"teacher"===i.role?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsxs)("header",{className:"sticky top-0 z-40 bg-white shadow-sm flex items-center justify-between h-16 px-4 lg:px-8 lg:hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-9 h-9 bg-gradient-to-br from-teal-500 to-green-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"M"})}),(0,a.jsx)("span",{className:"font-semibold text-lg text-gray-900 hidden sm:inline",children:"Mutabaahly"})]}),(0,a.jsx)("button",{className:"lg:hidden p-2 rounded-md text-teal-700 hover:bg-teal-50",onClick:()=>d(e=>!e),children:(0,a.jsx)("svg",{className:"h-7 w-7",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),(0,a.jsx)(g.Z,{isMobileMenuOpen:o,setIsMobileMenuOpen:d}),(0,a.jsxs)("main",{className:"lg:pl-64 min-h-screen",children:[l&&(0,a.jsx)("div",{className:"pt-6 px-4 lg:px-8",children:(0,a.jsx)(N.Z,{items:l})}),(0,a.jsx)("div",{className:"container mx-auto pt-2 pb-6 px-4 lg:px-8",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:s})})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[l&&(0,a.jsx)("div",{className:"pt-6 px-4 lg:px-8",children:(0,a.jsx)(N.Z,{items:l})}),(0,a.jsx)("main",{className:"container mx-auto pt-2 pb-6 px-4 lg:px-8",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:s})})]}):null},b=l(37435),y=l(87095),w=l(7825),C=l(46573),Z=l(64712),_=l(114),A=l(21741),F=l(22972),O=l(27742);let k=["image/jpeg","image/png","image/gif","image/webp"];function E(e){var s,l,i;let{isOpen:n,onClose:c,onProfileUpdated:o}=e,{user:d,profile:m}=(0,t.a)(),[x,h]=(0,r.useState)((null==m?void 0:m.full_name)||""),[u,j]=(0,r.useState)(!1),[g,N]=(0,r.useState)((null==m?void 0:m.avatar_url)||null),[v,E]=(0,r.useState)(!1),[z,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{n&&m?(h(m.full_name||""),N(m.avatar_url||null)):n||(h(""),N(null),j(!1),E(!1))},[n,m]);let P=()=>{let e=x.trim();return e?e.length<2?(Z.Am.error("Full name must be at least 2 characters long"),!1):!(e.length>100)||(Z.Am.error("Full name must be less than 100 characters"),!1):(Z.Am.error("Full name is required"),!1)},U=async e=>{if(e.preventDefault(),!(null==d?void 0:d.id)){Z.Am.error("User not authenticated");return}if(P()){j(!0);try{let e=x.trim(),{error:s}=await C.O.from("profiles").update({full_name:e,avatar_url:g,updated_at:new Date().toISOString()}).eq("id",d.id);if(s)throw console.error("Profile update error:",s),Error(s.message||"Failed to update profile");Z.Am.success("Profile updated successfully"),o(),c()}catch(s){console.error("Error updating profile:",s);let e=s instanceof Error?s.message:"Failed to update profile";Z.Am.error(e)}finally{j(!1)}}},S=async e=>{var s,l;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(e.target.value="",a){if(!(null==d?void 0:d.id)){Z.Am.error("User not authenticated");return}if(a.size>5242880){Z.Am.error("File size must be less than 5MB");return}if(!k.includes(a.type)){Z.Am.error("Only JPG, PNG, GIF, and WebP images are allowed");return}try{E(!0);let e=(null===(l=a.name.split(".").pop())||void 0===l?void 0:l.toLowerCase())||"jpg",s=Date.now(),r="".concat(d.id,"/avatar_").concat(s,".").concat(e),{error:t,data:i}=await C.O.storage.from("avatars").upload(r,a,{cacheControl:"3600",contentType:a.type});if(t)throw console.error("Upload error:",t),Error(t.message||"Failed to upload image");if(!(null==i?void 0:i.path))throw Error("Upload successful but no file path returned");let{data:{publicUrl:n}}=C.O.storage.from("avatars").getPublicUrl(i.path);if(!n)throw Error("Failed to get public URL for uploaded image");if(g&&g!==n)try{let e=new URL(g).pathname.split("/avatars/")[1];e&&e.startsWith(d.id)&&await C.O.storage.from("avatars").remove([e])}catch(e){console.warn("Failed to remove old avatar:",e)}N(n),Z.Am.success("Profile picture updated successfully")}catch(s){console.error("Error uploading image:",s);let e=s instanceof Error?s.message:"Failed to upload profile picture";Z.Am.error(e)}finally{E(!1)}}},M=async()=>{if((null==d?void 0:d.id)&&g){I(!0);try{let e=g.split("/").slice(-2).join("/"),{error:s}=await C.O.storage.from("avatars").remove([e]);if(s)throw s;let{error:l}=await C.O.from("profiles").update({avatar_url:null}).eq("id",d.id);if(l)throw l;N(null),Z.Am.success("Profile photo deleted"),o()}catch(e){console.error("Error deleting photo:",e),Z.Am.error("Failed to delete profile photo")}finally{I(!1)}}},q=()=>{if(u||v){Z.Am.error("Please wait for the current operation to complete");return}c()};return d?(0,a.jsx)(b.Vq,{open:n,onOpenChange:q,children:(0,a.jsxs)(b.cZ,{className:"sm:max-w-[425px]","aria-describedby":"edit-profile-description",children:[(0,a.jsx)(b.fK,{children:(0,a.jsx)(b.$N,{children:"Edit Profile"})}),(0,a.jsx)("div",{id:"edit-profile-description",className:"sr-only",children:"Update your profile information and upload a profile picture."}),(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(f.qE,{className:"h-24 w-24",children:[(0,a.jsx)(f.F$,{src:g||void 0,alt:x?"".concat(x,"'s avatar"):"User avatar"}),(0,a.jsx)(f.Q5,{className:"text-lg font-semibold",children:(null==x?void 0:null===(s=x.charAt(0))||void 0===s?void 0:s.toUpperCase())||(null==m?void 0:null===(i=m.full_name)||void 0===i?void 0:null===(l=i.charAt(0))||void 0===l?void 0:l.toUpperCase())||"U"})]}),(0,a.jsxs)("label",{htmlFor:"avatar-upload",className:(0,O.cn)("absolute bottom-0 right-0 cursor-pointer rounded-full bg-primary p-2 text-primary-foreground hover:bg-primary/90 transition-colors",(v||u)&&"opacity-50 cursor-not-allowed"),title:"Upload profile picture",children:[v?(0,a.jsx)(_.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("input",{id:"avatar-upload",type:"file",accept:k.join(","),className:"hidden",onChange:S,disabled:v||u})]}),g&&(0,a.jsx)("button",{type:"button",onClick:M,className:"absolute top-0 left-0 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 shadow-md transition-colors",disabled:z,title:"Delete photo",children:z?(0,a.jsx)(_.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(F.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["Click the camera icon to upload a new profile picture",(0,a.jsx)("br",{}),"Maximum size: 5MB â€¢ Formats: JPG, PNG, GIF, WebP"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"fullName",children:"Full Name *"}),(0,a.jsx)(y.I,{id:"fullName",value:x,onChange:e=>h(e.target.value),placeholder:"Enter your full name",required:!0,maxLength:100,disabled:u||v,autoComplete:"name"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,a.jsx)(p.z,{type:"button",variant:"outline",onClick:q,disabled:u||v,children:"Cancel"}),(0,a.jsx)(p.z,{type:"submit",disabled:u||v||!x.trim(),children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})}):null}var z=l(11099),I=l(70550);function P(e){let{isOpen:s,onClose:l}=e,{profile:i,signOut:n}=(0,t.a)(),c=(0,j.useRouter)(),[o,d]=r.useState(!1),m=async()=>{if(null==i?void 0:i.id){d(!0);try{let{error:e}=await I.O.from("profiles").delete().eq("id",i.id);if(e)throw e;let{error:s}=await I.O.auth.admin.deleteUser(i.id);if(s)throw s;await n(),c.push("/"),Z.Am.success("Account deleted successfully")}catch(e){console.error("Error deleting account:",e),Z.Am.error("Failed to delete account")}finally{d(!1),l()}}};return(0,a.jsx)(z.aR,{open:s,onOpenChange:l,children:(0,a.jsxs)(z._T,{children:[(0,a.jsxs)(z.fY,{children:[(0,a.jsx)(z.f$,{children:"Are you absolutely sure?"}),(0,a.jsx)(z.yT,{children:"This action cannot be undone. This will permanently delete your account and remove all associated data from our servers."})]}),(0,a.jsxs)(z.xo,{children:[(0,a.jsx)(z.le,{disabled:o,children:"Cancel"}),(0,a.jsx)(z.OL,{onClick:m,disabled:o,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:o?"Deleting...":"Delete Account"})]})]})})}var U=l(55051),S=l(98408),M=()=>{var e,s;let{user:l,profile:g,signOut:N}=(0,t.a)(),[b,y]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),Z=(0,j.useRouter)(),_=[{label:"Dashboard",href:"/dashboard"},{label:"Profile"}],A=()=>{y(!0)},F=()=>{C(!0)},O=()=>{},k=async()=>{await N(),Z.push("/")};return g?"parent"===g.role?(0,a.jsxs)(S.Z,{breadcrumbs:_,children:[(0,a.jsxs)("div",{className:"container mx-auto px-0 py-0 md:px-6 md:py-6 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>Z.back(),className:"p-0 m-0 bg-transparent border-none outline-none flex items-center","aria-label":"Back",children:(0,a.jsx)(n.Z,{className:"h-6 w-6"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"})]}),(0,a.jsx)(i.Zb,{className:"mb-6",children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute right-0 top-0",children:(0,a.jsxs)(U.h_,{children:[(0,a.jsx)(U.$F,{asChild:!0,children:(0,a.jsx)(p.z,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-gray-100 rounded-full",children:(0,a.jsx)(c.Z,{className:"h-4 w-4 text-gray-500"})})}),(0,a.jsxs)(U.AW,{align:"end",className:"w-48",children:[(0,a.jsxs)(U.Xi,{onClick:A,className:"cursor-pointer",children:[(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{children:"Edit Profile"})]}),(0,a.jsx)(U.VD,{}),(0,a.jsxs)(U.Xi,{onClick:F,className:"cursor-pointer text-red-600 focus:text-red-600",children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Delete Account"})]})]})]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)(f.qE,{className:"h-24 w-24 mb-4",children:[(0,a.jsx)(f.F$,{src:(null==g?void 0:g.avatar_url)||void 0}),(0,a.jsx)(f.Q5,{className:"bg-gradient-to-r from-green-400 to-teal-500 text-white text-xl",children:null==g?void 0:null===(e=g.full_name)||void 0===e?void 0:e.split(" ").map(e=>e[0]).join("").toUpperCase()})]}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-1",children:null==g?void 0:g.full_name}),(0,a.jsx)("p",{className:"text-gray-500 capitalize",children:null==g?void 0:g.role})]})]})})}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"p-6 pb-0",children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2 text-gray-800",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 text-teal-500"}),"Account Information"]})}),(0,a.jsxs)(i.aY,{className:"space-y-6 p-6 pt-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==g?void 0:g.full_name)||"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==l?void 0:l.email)||"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(h.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Role"}),(0,a.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:(null==g?void 0:g.role)||"Not set"})]})]})]})]}),(0,a.jsx)("div",{className:"md:hidden mt-6",children:(0,a.jsxs)(p.z,{onClick:k,variant:"outline",className:"w-full flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5"}),"Sign Out"]})})]}),(0,a.jsx)(E,{isOpen:b,onClose:()=>y(!1),onProfileUpdated:O}),(0,a.jsx)(P,{isOpen:w,onClose:()=>C(!1)})]}):(0,a.jsxs)(v,{breadcrumbs:_,children:[(0,a.jsxs)("div",{className:"container mx-auto px-0 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 mb-6",children:[(0,a.jsx)("button",{type:"button",onClick:()=>Z.back(),className:"p-0 m-0 bg-transparent border-none outline-none flex items-center","aria-label":"Back",children:(0,a.jsx)(n.Z,{className:"h-6 w-6"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"})]}),(0,a.jsx)(i.Zb,{className:"mb-6",children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute right-0 top-0",children:(0,a.jsxs)(U.h_,{children:[(0,a.jsx)(U.$F,{asChild:!0,children:(0,a.jsx)(p.z,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-gray-100 rounded-full",children:(0,a.jsx)(c.Z,{className:"h-4 w-4 text-gray-500"})})}),(0,a.jsxs)(U.AW,{align:"end",className:"w-48",children:[(0,a.jsxs)(U.Xi,{onClick:A,className:"cursor-pointer",children:[(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{children:"Edit Profile"})]}),(0,a.jsx)(U.VD,{}),(0,a.jsxs)(U.Xi,{onClick:F,className:"cursor-pointer text-red-600 focus:text-red-600",children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Delete Account"})]})]})]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)(f.qE,{className:"h-24 w-24 mb-4",children:[(0,a.jsx)(f.F$,{src:(null==g?void 0:g.avatar_url)||void 0}),(0,a.jsx)(f.Q5,{className:"bg-gradient-to-r from-green-400 to-teal-500 text-white text-xl",children:null==g?void 0:null===(s=g.full_name)||void 0===s?void 0:s.split(" ").map(e=>e[0]).join("").toUpperCase()})]}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-1",children:null==g?void 0:g.full_name}),(0,a.jsx)("p",{className:"text-gray-500 capitalize",children:null==g?void 0:g.role})]})]})})}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"p-6 pb-0",children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2 text-gray-800",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 text-teal-500"}),"Account Information"]})}),(0,a.jsxs)(i.aY,{className:"space-y-6 p-6 pt-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==g?void 0:g.full_name)||"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==l?void 0:l.email)||"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)(h.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Role"}),(0,a.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:(null==g?void 0:g.role)||"Not set"})]})]})]})]})]}),(0,a.jsx)(E,{isOpen:b,onClose:()=>y(!1),onProfileUpdated:O}),(0,a.jsx)(P,{isOpen:w,onClose:()=>C(!1)})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}}},function(e){e.O(0,[9332,1799,8288,1664,1063,1134,6437,318,7529,2888,9774,179],function(){return e(e.s=89975)}),_N_E=e.O()}]);