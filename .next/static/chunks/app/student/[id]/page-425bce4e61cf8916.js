(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7541],{20067:function(){},72061:function(){},10357:function(e,s,t){Promise.resolve().then(t.bind(t,54506))},54506:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eh}});var a=t(57437),r=t(2265),l=t(99376),n=t(12381),i=t(92451),d=()=>{let e=(0,l.useRouter)();return(0,a.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-0 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-row items-center gap-4 w-full sm:w-auto",children:[(0,a.jsx)("button",{type:"button",onClick:()=>e.back(),className:"p-0 m-0 bg-transparent border-none outline-none flex items-center","aria-label":"Back",children:(0,a.jsx)(i.Z,{className:"h-6 w-6"})}),(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Student Details"})]})})},c=t(79820),o=t(60610),h=t(93448);let x=r.forwardRef((e,s)=>{let{className:t,value:r,indicatorClassName:l,...n}=e;return(0,a.jsx)(o.fC,{ref:s,className:(0,h.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:(0,a.jsx)(o.z$,{className:(0,h.cn)("h-full w-full flex-1 bg-primary transition-all",l),style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});x.displayName=o.fC.displayName;var u=t(96246),m=t(71533),g=t(45675),p=t(18930),j=t(92369),f=t(33327),v=t(71769),y=t(74291),N=t(88455),b=t(40279),w=t(75060),_=t(23675),S=t(15291),C=t(99397),D=t(1072),P=t(23340),E=t(53528),k=t(46992),z=e=>{let{studentId:s,onProgressAdded:t}=e,[l,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1),{profile:o}=(0,E.a)(),[h,x]=(0,r.useState)({type:"",date:new Date().toISOString().split("T")[0],surah_or_jilid:"",ayat_or_page:"",notes:""}),{toast:u}=(0,P.pm)();if((null==o?void 0:o.role)!=="teacher")return null;let m=async e=>{e.preventDefault(),c(!0);try{if((null==o?void 0:o.role)!=="teacher"){u({title:"Unauthorized",description:"Only teachers can add progress entries.",variant:"destructive"});return}let{error:e}=await D.O.from("progress_entries").insert([{student_id:s,...h}]);if(e)throw e;u({title:"Success",description:"Progress entry added successfully!"}),x({type:"",date:new Date().toISOString().split("T")[0],surah_or_jilid:"",ayat_or_page:"",notes:""}),i(!1),t()}catch(e){console.error("Error adding progress:",e),u({title:"Error",description:"Failed to add progress entry. Please try again.",variant:"destructive"})}finally{c(!1)}},g=(e,s)=>{x(t=>({...t,[e]:s}))};return(0,a.jsxs)(y.Vq,{open:l,onOpenChange:i,children:[(0,a.jsx)(y.hg,{asChild:!0,children:(0,a.jsxs)(n.z,{className:"bg-gradient-to-r from-emerald-500 to-teal-400 hover:opacity-90",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Add Progress"]})}),(0,a.jsxs)(y.cZ,{className:"sm:max-w-[425px]","aria-describedby":"add-progress-description",children:[(0,a.jsxs)(y.fK,{children:[(0,a.jsx)(y.$N,{children:"Add Daily Progress"}),(0,a.jsx)(y.Be,{id:"add-progress-description",children:"Fill in the details to add a new daily progress entry for the student."})]}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"type",children:"Progress Type"}),(0,a.jsxs)(S.Ph,{value:h.type,onValueChange:e=>g("type",e),children:[(0,a.jsx)(S.i4,{children:(0,a.jsx)(S.ki,{placeholder:"Select progress type"})}),(0,a.jsxs)(S.Bw,{children:[(0,a.jsx)(S.Ql,{value:"hafalan",children:"Tahfidz"}),(0,a.jsx)(S.Ql,{value:"tilawah",children:"Tahsin"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"date",children:"Date"}),(0,a.jsx)(b.I,{id:"date",type:"date",value:h.date,onChange:e=>g("date",e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"surah_or_jilid",children:"hafalan"===h.type?"Surah":"Jilid/Level"}),"hafalan"===h.type?(0,a.jsxs)(S.Ph,{value:h.surah_or_jilid,onValueChange:e=>g("surah_or_jilid",e),children:[(0,a.jsx)(S.i4,{children:(0,a.jsx)(S.ki,{placeholder:"Select a surah"})}),(0,a.jsx)(S.Bw,{children:k.n5.map(e=>(0,a.jsxs)(S.Ql,{value:e.name,children:[e.name," (",e.verses," verses)"]},e.number))})]}):(0,a.jsx)(b.I,{id:"surah_or_jilid",value:h.surah_or_jilid,onChange:e=>g("surah_or_jilid",e.target.value),placeholder:"e.g., Jilid 1"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"ayat_or_page",children:"hafalan"===h.type?"Ayat":"Page/Verse"}),(0,a.jsx)(b.I,{id:"ayat_or_page",value:h.ayat_or_page,onChange:e=>g("ayat_or_page",e.target.value),placeholder:"hafalan"===h.type?"e.g., 1-7":"e.g., Page 15"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"notes",children:"Notes (Optional)"}),(0,a.jsx)(_.g,{id:"notes",value:h.notes,onChange:e=>g("notes",e.target.value),placeholder:"Additional notes about the progress..."})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,a.jsx)(N.O,{type:"submit",disabled:d,children:d?"Adding...":"Add Progress"})]})]})]})]})},F=t(15868),O=t(39079),T=t(10271),Z=e=>{let{student:s,onStudentUpdated:t}=e,[l,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1),[o,h]=(0,r.useState)(null),[x,u]=(0,r.useState)({name:s.name,group_name:s.group_name,teacher:s.teacher}),{toast:m}=(0,P.pm)(),{profile:g}=(0,E.a)();if((null==g?void 0:g.role)!=="teacher")return null;let p=async e=>{try{let t=e.name.split(".").pop(),a="".concat(s.id,"-").concat(Math.random(),".").concat(t),r="student-photos/".concat(a),{error:l}=await D.O.storage.from("student-photos").upload(r,e);if(l)throw l;let{data:n}=D.O.storage.from("student-photos").getPublicUrl(r);return n.publicUrl}catch(e){return console.error("Error uploading image:",e),null}},j=async e=>{if(e.preventDefault(),(null==g?void 0:g.role)!=="teacher"){m({title:"Error",description:"You don't have permission to edit students.",variant:"destructive"});return}c(!0);try{let e=s.photo;if(o&&!(e=await p(o)))throw Error("Failed to upload image");let{error:a}=await D.O.from("students").update({...x,photo:e}).eq("id",s.id);if(a)throw a;m({title:"Success",description:"Student updated successfully!"}),i(!1),t()}catch(e){console.error("Error updating student:",e),m({title:"Error",description:"Failed to update student. Please try again.",variant:"destructive"})}finally{c(!1)}},f=(e,s)=>{u(t=>({...t,[e]:s}))};return(0,a.jsxs)(y.Vq,{open:l,onOpenChange:i,children:[(0,a.jsx)(y.hg,{asChild:!0,children:(0,a.jsxs)(n.z,{variant:"outline",size:"sm",id:"edit-student-trigger",children:[(0,a.jsx)(F.Z,{className:"h-4 w-4 mr-2"}),"Edit"]})}),(0,a.jsxs)(y.cZ,{className:"sm:max-w-[425px]","aria-describedby":"edit-student-description",children:[(0,a.jsxs)(y.fK,{children:[(0,a.jsx)(y.$N,{children:"Edit Student"}),(0,a.jsx)(y.Be,{id:"edit-student-description",children:"Update the student information below."})]}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"photo",children:"Profile Photo"}),(0,a.jsx)(O.Z,{onFileSelect:h,currentImage:s.photo})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"name",children:"Student Name"}),(0,a.jsx)(b.I,{id:"name",value:x.name,onChange:e=>f("name",e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"group_name",children:"Group/Class"}),(0,a.jsx)(b.I,{id:"group_name",value:x.group_name,onChange:e=>f("group_name",e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"teacher",children:"Teacher"}),(0,a.jsxs)(S.Ph,{value:x.teacher,onValueChange:e=>f("teacher",e),required:!0,children:[(0,a.jsx)(S.i4,{className:"w-full",children:(0,a.jsx)(S.ki,{placeholder:"Select teacher"})}),(0,a.jsx)(S.Bw,{children:T.LQ.map(e=>(0,a.jsx)(S.Ql,{value:e.name,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,a.jsx)(n.z,{type:"submit",disabled:d,children:d?"Updating...":"Update Student"})]})]})]})]})},A=t(30767),I=e=>{let{studentId:s,studentName:t,onStudentDeleted:l}=e,[i,d]=(0,r.useState)(!1),{toast:c}=(0,P.pm)(),{profile:o}=(0,E.a)();if((null==o?void 0:o.role)!=="teacher")return null;let h=async()=>{if((null==o?void 0:o.role)!=="teacher"){c({title:"Error",description:"You don't have permission to delete students.",variant:"destructive"});return}d(!0);try{await D.O.from("progress_entries").delete().eq("student_id",s),await D.O.from("hafalan_progress").delete().eq("student_id",s),await D.O.from("tilawah_progress").delete().eq("student_id",s);let{error:e}=await D.O.from("students").delete().eq("id",s);if(e)throw e;c({title:"Success",description:"Student deleted successfully!"}),l()}catch(e){console.error("Error deleting student:",e),c({title:"Error",description:"Failed to delete student. Please try again.",variant:"destructive"})}finally{d(!1)}};return(0,a.jsxs)(A.aR,{children:[(0,a.jsx)(A.vW,{asChild:!0,children:(0,a.jsxs)(n.z,{variant:"destructive",size:"sm",id:"delete-student-trigger",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})}),(0,a.jsxs)(A._T,{children:[(0,a.jsxs)(A.fY,{children:[(0,a.jsx)(A.f$,{children:"Are you sure?"}),(0,a.jsxs)(A.yT,{children:["This will permanently delete ",(0,a.jsx)("strong",{children:t})," and all their progress data. This action cannot be undone."]})]}),(0,a.jsxs)(A.xo,{children:[(0,a.jsx)(A.le,{children:"Cancel"}),(0,a.jsx)(A.OL,{onClick:h,disabled:i,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i?"Deleting...":"Delete"})]})]})]})},L=t(32060),R=t(69174),q=e=>{var s,t,r,l;let{student:i,progressData:d,onProgressAdded:o,onStudentUpdated:h,onStudentDeleted:y}=e,{profile:N}=(0,E.a)(),b=(null==N?void 0:N.role)==="teacher",w=(null==d?void 0:null===(s=d.hafalan_progress)||void 0===s?void 0:s.percentage)||0,_=(null==d?void 0:null===(t=d.hafalan_progress)||void 0===t?void 0:t.last_surah)||"Not started",S=(null==d?void 0:null===(r=d.tilawah_progress)||void 0===r?void 0:r.percentage)||0,C=(null==d?void 0:null===(l=d.tilawah_progress)||void 0===l?void 0:l.jilid)||"Not started",D=e=>e>=80?"bg-islamic-500":e>=60?"bg-blue-500":e>=40?"bg-accent-500":"bg-gray-500";return(0,a.jsx)(c.Zb,{className:"mb-8",children:(0,a.jsx)(c.aY,{className:"p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-start lg:space-x-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center mb-4 lg:mb-0 w-full lg:w-auto relative",children:[b&&(0,a.jsx)("div",{className:"absolute right-0 top-0 lg:hidden",children:(0,a.jsxs)(L.h_,{children:[(0,a.jsx)(L.$F,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(L.AW,{align:"end",children:[(0,a.jsxs)(L.Xi,{onSelect:()=>{var e;return null===(e=document.getElementById("edit-student-trigger"))||void 0===e?void 0:e.click()},children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Edit Profile"]}),(0,a.jsxs)(L.Xi,{className:"text-destructive focus:text-destructive",onSelect:()=>{var e;return null===(e=document.getElementById("delete-student-trigger"))||void 0===e?void 0:e.click()},children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Delete Profile"]})]})]})}),(0,a.jsxs)(u.qE,{className:"h-24 w-24 sm:h-28 sm:w-28 lg:h-32 lg:w-32",children:[(0,a.jsx)(u.F$,{src:i.photo||"",alt:i.name}),(0,a.jsx)(u.Q5,{className:"text-xl sm:text-2xl font-semibold bg-muted",children:i.name.split(" ").map(e=>e[0]).join("").toUpperCase()})]}),(0,a.jsxs)("div",{className:"block lg:hidden mt-4 w-full",children:[(0,a.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-foreground text-center",children:i.name}),(0,a.jsxs)("div",{className:"flex flex-row flex-wrap gap-2 justify-center w-full mt-2",children:[(0,a.jsx)(R.C,{variant:"outline",className:"border-islamic-200 text-islamic-700",children:i.group_name}),(0,a.jsxs)(R.C,{variant:"secondary",className:"bg-accent/10 text-accent-foreground/80",children:[(0,a.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),i.teacher]})]})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"hidden lg:block text-left mb-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,a.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:i.name}),(0,a.jsxs)("div",{className:"flex flex-row flex-wrap gap-2 justify-start w-full",children:[(0,a.jsx)(R.C,{variant:"outline",className:"border-islamic-200 text-islamic-700",children:i.group_name}),(0,a.jsxs)(R.C,{variant:"secondary",className:"bg-accent/10 text-accent-foreground/80",children:[(0,a.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),i.teacher]})]})]}),b&&(0,a.jsxs)(L.h_,{children:[(0,a.jsx)(L.$F,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(L.AW,{align:"end",children:[(0,a.jsxs)(L.Xi,{onSelect:()=>{var e;return null===(e=document.getElementById("edit-student-trigger"))||void 0===e?void 0:e.click()},children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Edit Profile"]}),(0,a.jsxs)(L.Xi,{className:"text-destructive focus:text-destructive",onSelect:()=>{var e;return null===(e=document.getElementById("delete-student-trigger"))||void 0===e?void 0:e.click()},children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Delete Profile"]})]})]})]})}),(0,a.jsxs)("div",{className:"hidden",children:[(0,a.jsx)(Z,{student:i,onStudentUpdated:h}),(0,a.jsx)(I,{studentId:i.id,studentName:i.name,onStudentDeleted:y})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Progress Overview"}),b&&(0,a.jsx)(z,{studentId:i.id,onProgressAdded:o})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-green-100 via-green-50 to-green-200 rounded-xl shadow-sm hover:shadow-md transition-shadow w-full h-full",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-3",children:[(0,a.jsx)(f.Z,{className:"h-6 w-6 text-green-600 mr-2"}),(0,a.jsx)("h3",{className:"font-semibold text-green-900",children:"Tahfidz Progress"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(x,{value:w,className:"h-2.5",indicatorClassName:D(w)}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground",children:[w,"% completed"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:_})]})]})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-100 via-blue-50 to-blue-200 rounded-xl shadow-sm hover:shadow-md transition-shadow w-full h-full",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-3",children:[(0,a.jsx)(v.Z,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,a.jsx)("h3",{className:"font-semibold text-blue-900",children:"Tahsin Progress"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(x,{value:S,className:"h-2.5",indicatorClassName:D(S)}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground",children:[S,"% completed"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:C})]})]})]})})]})]})]})]})})})},U=t(20271);let B=U.fC,V=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(U.aV,{ref:s,className:(0,h.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r})});V.displayName=U.aV.displayName;let Y=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(U.xz,{ref:s,className:(0,h.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r})});Y.displayName=U.xz.displayName;let Q=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(U.VY,{ref:s,className:(0,h.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r})});Q.displayName=U.VY.displayName;var $=t(33804),J=e=>{let{entry:s,onProgressUpdated:t}=e,[l,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1),[o,h]=(0,r.useState)({date:s.date,surah_or_jilid:s.surah_or_jilid||"",ayat_or_page:s.ayat_or_page||"",notes:s.notes||""}),{toast:x}=(0,P.pm)(),u=async e=>{e.preventDefault(),c(!0);try{let{error:e}=await D.O.from("progress_entries").update(o).eq("id",s.id);if(e)throw e;x({title:"Success",description:"Progress updated successfully!"}),i(!1),t()}catch(e){console.error("Error updating progress:",e),x({title:"Error",description:"Failed to update progress. Please try again.",variant:"destructive"})}finally{c(!1)}},m=(e,s)=>{h(t=>({...t,[e]:s}))};return(0,a.jsxs)(y.Vq,{open:l,onOpenChange:i,children:[(0,a.jsx)(y.hg,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(F.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(y.cZ,{className:"sm:max-w-[425px]","aria-describedby":"edit-progress-description",children:[(0,a.jsxs)(y.fK,{children:[(0,a.jsxs)(y.$N,{children:["Edit ","hafalan"===s.type?"Hafalan":"Tilawati"," Progress"]}),(0,a.jsx)(y.Be,{id:"edit-progress-description",children:"Update the progress details for this entry."})]}),(0,a.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"date",children:"Date"}),(0,a.jsx)(b.I,{id:"date",type:"date",value:o.date,onChange:e=>m("date",e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"surah_or_jilid",children:"hafalan"===s.type?"Surah":"Jilid/Level"}),"hafalan"===s.type?(0,a.jsxs)(S.Ph,{value:o.surah_or_jilid,onValueChange:e=>m("surah_or_jilid",e),children:[(0,a.jsx)(S.i4,{children:(0,a.jsx)(S.ki,{placeholder:"Select a surah"})}),(0,a.jsx)(S.Bw,{children:k.n5.map(e=>(0,a.jsxs)(S.Ql,{value:e.name,children:[e.name," (",e.verses," verses)"]},e.number))})]}):(0,a.jsx)(b.I,{id:"surah_or_jilid",value:o.surah_or_jilid,onChange:e=>m("surah_or_jilid",e.target.value),placeholder:"e.g., Jilid 1"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"ayat_or_page",children:"hafalan"===s.type?"Ayat":"Page"}),(0,a.jsx)(b.I,{id:"ayat_or_page",value:o.ayat_or_page,onChange:e=>m("ayat_or_page",e.target.value),placeholder:"hafalan"===s.type?"e.g., 1-7":"e.g., 5"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w._,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(_.g,{id:"notes",value:o.notes,onChange:e=>m("notes",e.target.value),placeholder:"Additional notes...",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,a.jsx)(n.z,{type:"submit",disabled:d,children:d?"Updating...":"Update Progress"})]})]})]})]})},M=e=>{let{entryId:s,entryType:t,onProgressDeleted:l}=e,[i,d]=(0,r.useState)(!1),{toast:c}=(0,P.pm)(),o=async()=>{d(!0);try{let{error:e}=await D.O.from("progress_entries").delete().eq("id",s);if(e)throw e;c({title:"Success",description:"Progress entry deleted successfully!"}),l()}catch(e){console.error("Error deleting progress:",e),c({title:"Error",description:"Failed to delete progress entry. Please try again.",variant:"destructive"})}finally{d(!1)}};return(0,a.jsxs)(A.aR,{children:[(0,a.jsx)(A.vW,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(p.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(A._T,{children:[(0,a.jsxs)(A.fY,{children:[(0,a.jsx)(A.f$,{children:"Delete Progress Entry"}),(0,a.jsxs)(A.yT,{children:["Are you sure you want to delete this ",t," progress entry? This action cannot be undone."]})]}),(0,a.jsxs)(A.xo,{children:[(0,a.jsx)(A.le,{children:"Cancel"}),(0,a.jsx)(A.OL,{onClick:o,disabled:i,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i?"Deleting...":"Delete"})]})]})]})},W=t(78867),X=t(10407),K=e=>{let{entries:s,type:t,onProgressUpdated:l,onDuplicateEntry:d}=e,{profile:c}=(0,E.a)(),o=(null==c?void 0:c.role)==="teacher",h="hafalan"===t,[x,u]=(0,r.useState)(10),[m,g]=(0,r.useState)(1),p=Math.ceil(s.length/x),j=s.slice((m-1)*x,m*x);return r.useEffect(()=>{g(1)},[s.length,x]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)($.iA,{children:[(0,a.jsx)($.xD,{children:(0,a.jsxs)($.SC,{children:[(0,a.jsx)($.ss,{children:"Date"}),(0,a.jsx)($.ss,{children:h?"Surah":"Jilid/Level"}),(0,a.jsx)($.ss,{children:h?"Ayat":"Page/Verse"}),(0,a.jsx)($.ss,{children:"Notes"}),o&&(0,a.jsx)($.ss,{children:"Actions"})]})}),(0,a.jsx)($.RM,{children:0===s.length?(0,a.jsx)($.SC,{children:(0,a.jsxs)($.pj,{colSpan:o?5:4,className:"text-center text-gray-500",children:["No ",t," progress recorded yet"]})}):j.map(e=>(0,a.jsxs)($.SC,{children:[(0,a.jsx)($.pj,{children:new Date(e.date).toLocaleDateString()}),(0,a.jsx)($.pj,{children:e.surah_or_jilid||"-"}),(0,a.jsx)($.pj,{children:e.ayat_or_page||"-"}),(0,a.jsx)($.pj,{children:e.notes||"-"}),o&&(0,a.jsx)($.pj,{children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)(J,{entry:e,onProgressUpdated:l}),(0,a.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded p-2 text-black transition-transform duration-150 hover:scale-110 hover:text-blue-600 focus:outline-none",title:"Duplicate",onClick:()=>d&&d(e),children:(0,a.jsx)(W.Z,{className:"h-4 w-4"})}),(0,a.jsx)(M,{entryId:e.id,entryType:t,onProgressDeleted:l})]})})]},e.id))})]}),p>1||s.length>0?(0,a.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 bg-white gap-2 flex flex-col sm:flex-row sm:items-center sm:relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 sm:mb-0",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Rows per page:"}),(0,a.jsxs)(S.Ph,{value:String(x),onValueChange:e=>u(Number(e)),children:[(0,a.jsx)(S.i4,{className:"w-16 h-8 text-xs",children:(0,a.jsx)(S.ki,{})}),(0,a.jsxs)(S.Bw,{children:[(0,a.jsx)(S.Ql,{value:"5",children:"5"}),(0,a.jsx)(S.Ql,{value:"10",children:"10"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 w-full sm:w-auto sm:ml-auto",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600 font-medium sm:absolute sm:left-1/2 sm:-translate-x-1/2 sm:w-auto",children:["Page ",m," of ",p]}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>g(m-1),disabled:1===m,"aria-label":"Previous Page",className:"ml-2 sm:ml-4",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Previous"})]}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>g(m+1),disabled:m===p,"aria-label":"Next Page",children:[(0,a.jsx)(X.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Next"})]})]})]}):null]})},G=t(2093),H=t(53375);let ee=e=>{let s=new Date(e);if(isNaN(s.getTime())){let s=e.split("-");if(3===s.length)return new Date(parseInt(s[0]),parseInt(s[1])-1,parseInt(s[2]));throw Error("Invalid date format: ".concat(e))}return s},es=e=>{let s=new Date(e);return s.setHours(0,0,0,0),s},et=e=>{let s=new Date(e);return s.setHours(23,59,59,999),s};var ea=e=>{let{open:s,onOpenChange:t,hafalanEntries:l,tilawahEntries:i}=e,[d]=(0,r.useState)([...l,...i]),c=d.map(e=>({...e,parsedDate:ee(e.date)})).sort((e,s)=>e.parsedDate.getTime()-s.parsedDate.getTime()),[o,h]=(0,r.useState)(!1),[x,u]=(0,r.useState)("today"),[m,g]=(0,r.useState)(null);r.useEffect(()=>{},[x,c.length]);let p=new Date,j=es(p),f=et(p),v=es(new Date(p.getFullYear(),p.getMonth(),p.getDate()-6)),N=es(new Date(p.getFullYear(),p.getMonth(),1)),b=et(new Date(p.getFullYear(),p.getMonth()+1,0)),w=c,_="";"today"===x?(w=c.filter(e=>e.parsedDate>=j&&e.parsedDate<=f),_="Today (".concat(j.toLocaleDateString(),")")):"7days"===x?(w=c.filter(e=>e.parsedDate>=v&&e.parsedDate<=f),_="Last 7 Days (".concat(v.toLocaleDateString()," - ").concat(f.toLocaleDateString(),")")):"month"===x&&(w=c.filter(e=>e.parsedDate>=N&&e.parsedDate<=b),_="This Month (".concat(N.toLocaleDateString()," - ").concat(b.toLocaleDateString(),")"));let C=()=>{if(0!==w.length){h(!0);try{let e=w.map(e=>({Date:e.parsedDate.toLocaleDateString("en-CA"),Type:e.type,"Surah/Jilid":e.surah_or_jilid||"-","Ayat/Page":e.ayat_or_page||"-",Notes:e.notes||"-"})),s=G.P6.json_to_sheet(e),a=G.P6.decode_range(s["!ref"]||"A1"),r=[];for(let e=a.s.c;e<=a.e.c;++e){let t=10;for(let r=a.s.r;r<=a.e.r;++r){let a=s[G.P6.encode_cell({r:r,c:e})];if(a&&a.v){let e=a.v.toString().length;e>t&&(t=e)}}r.push({wch:Math.min(t+2,50)})}s["!cols"]=r;let l=G.P6.book_new();G.P6.book_append_sheet(l,s,"Progress Entries");let n="progress_entries_".concat(x,"_").concat(new Date().toLocaleDateString("en-CA"),".xlsx");G.NC(l,n),t(!1)}catch(e){console.error("Error exporting Excel:",e)}finally{h(!1)}}},D=()=>{if(0!==w.length){h(!0);try{let e=new H.ZP;e.setFontSize(16),e.text("Progress Entries Report",20,20),e.setFontSize(10),e.text(_,20,30),e.text("Total Entries: ".concat(w.length),20,35);let s=45;e.setFontSize(8),e.text("Date",20,s),e.text("Type",50,s),e.text("Surah/Jilid",80,s),e.text("Ayat/Page",120,s),e.text("Notes",150,s),e.line(20,s+2,190,s+2),s+=8,w.forEach(t=>{s>280&&(e.addPage(),s=20,e.setFontSize(8),e.text("Date",20,s),e.text("Type",50,s),e.text("Surah/Jilid",80,s),e.text("Ayat/Page",120,s),e.text("Notes",150,s),e.line(20,s+2,190,s+2),s+=8),e.setFontSize(8),e.text(t.parsedDate.toLocaleDateString(),20,s),e.text(t.type,50,s),e.text(t.surah_or_jilid||"-",80,s),e.text(t.ayat_or_page||"-",120,s);let a=t.notes||"-",r=a.length>25?a.substring(0,25)+"...":a;e.text(r,150,s),s+=6});let a="progress_entries_".concat(x,"_").concat(new Date().toLocaleDateString("en-CA"),".pdf");e.save(a),t(!1)}catch(e){console.error("Error exporting PDF:",e)}finally{h(!1)}}},P=()=>{"excel"===m&&C(),"pdf"===m&&D(),g(null)};return(0,a.jsx)(y.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(y.cZ,{className:"max-w-md w-full p-6",children:[(0,a.jsxs)(y.fK,{children:[(0,a.jsx)(y.$N,{children:"Export Progress Entries"}),(0,a.jsx)(y.Be,{children:"Choose a range and export the student's progress as Excel or PDF."})]}),(0,a.jsxs)("div",{className:"mb-4 bg-gray-50 rounded p-3",children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"Select Range"}),(0,a.jsxs)(S.Ph,{value:x,onValueChange:e=>u(e),children:[(0,a.jsx)(S.i4,{className:"w-full",children:(0,a.jsx)(S.ki,{placeholder:"Select range"})}),(0,a.jsxs)(S.Bw,{children:[(0,a.jsx)(S.Ql,{value:"today",children:"This Day"}),(0,a.jsx)(S.Ql,{value:"7days",children:"Last 7 Days"}),(0,a.jsx)(S.Ql,{value:"month",children:"This Month"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2 mb-1",children:_.replace(/'/g,"&apos;")}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[w.length," entries will be exported."]}),w.length>0&&(0,a.jsx)("div",{className:"mt-4 border rounded bg-white overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold text-gray-600",children:"Date"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold text-gray-600",children:"Type"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold text-gray-600",children:"Surah/Jilid"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold text-gray-600",children:"Ayat/Page"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold text-gray-600",children:"Notes"})]})}),(0,a.jsx)("tbody",{children:w.map(e=>(0,a.jsxs)("tr",{className:"border-b last:border-0",children:[(0,a.jsx)("td",{className:"px-2 py-1",children:e.parsedDate.toLocaleDateString()}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.type}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.surah_or_jilid||"-"}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.ayat_or_page||"-"}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.notes?e.notes.length>20?e.notes.slice(0,20)+"...":e.notes:"-"})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 justify-end",children:[(0,a.jsxs)(A.aR,{children:[(0,a.jsx)(A.vW,{asChild:!0,children:(0,a.jsx)(n.z,{onClick:()=>g("excel"),disabled:o||0===w.length,variant:"outline",className:"flex-1 transition-transform duration-200 hover:scale-105 border-2 border-gray-400 text-gray-700 hover:border-green-400 hover:bg-gradient-to-r hover:from-green-400 hover:to-teal-500 hover:text-white",children:"Export as Excel"})}),(0,a.jsxs)(A._T,{children:[(0,a.jsxs)(A.fY,{children:[(0,a.jsx)(A.f$,{children:"Confirm Export"}),(0,a.jsx)(A.yT,{children:"Are you sure you want to export progress for ".concat(_,"?")})]}),(0,a.jsxs)(A.xo,{children:[(0,a.jsx)(A.le,{onClick:()=>g(null),children:"Cancel"}),(0,a.jsx)(A.OL,{onClick:P,children:"Export"})]})]})]}),(0,a.jsxs)(A.aR,{children:[(0,a.jsx)(A.vW,{asChild:!0,children:(0,a.jsx)(n.z,{onClick:()=>g("pdf"),disabled:o||0===w.length,variant:"outline",className:"flex-1 transition-transform duration-200 hover:scale-105 border-2 border-gray-400 text-gray-700 hover:border-green-400 hover:bg-gradient-to-r hover:from-green-400 hover:to-teal-500 hover:text-white",children:"Export as PDF"})}),(0,a.jsxs)(A._T,{children:[(0,a.jsxs)(A.fY,{children:[(0,a.jsx)(A.f$,{children:"Confirm Export"}),(0,a.jsx)(A.yT,{children:"Are you sure you want to export progress for ".concat(_,"?")})]}),(0,a.jsxs)(A.xo,{children:[(0,a.jsx)(A.le,{onClick:()=>g(null),children:"Cancel"}),(0,a.jsx)(A.OL,{onClick:P,children:"Export"})]})]})]}),(0,a.jsx)(y.GG,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",className:"flex-1",children:"Cancel"})})]}),0===w.length&&(0,a.jsx)("div",{className:"text-center text-sm text-red-500 mt-2",children:"No entries found in the selected range."}),0===d.length&&(0,a.jsx)("div",{className:"text-center text-sm text-gray-500 mt-2",children:"No entries available to export."})]})})},er=e=>{let{hafalanEntries:s,tilawahEntries:t,onProgressUpdated:l,studentId:i}=e,[d,o]=r.useState(!1),h=async(e,s)=>{if(!i)return;let t={student_id:i,date:new Date().toISOString().split("T")[0],type:s.type,surah_or_jilid:s.surah_or_jilid,ayat_or_page:s.ayat_or_page,notes:s.notes},{error:a}=await D.O.from("progress_entries").insert([t]);a||l()};return(0,a.jsxs)(c.Zb,{children:[(0,a.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(c.ll,{children:"Daily Progress Records"}),(0,a.jsx)(n.z,{variant:"outline",onClick:()=>o(!0),children:"Export"}),(0,a.jsx)(ea,{open:d,onOpenChange:o,hafalanEntries:s,tilawahEntries:t})]}),(0,a.jsx)(c.aY,{children:(0,a.jsxs)(B,{defaultValue:"hafalan",className:"w-full",children:[(0,a.jsxs)(V,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(Y,{value:"hafalan",className:"data-[state=active]:bg-green-100 data-[state=active]:text-green-700",children:"Tahfidz"}),(0,a.jsx)(Y,{value:"tilawah",className:"data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700",children:"Tahsin"})]}),(0,a.jsx)(Q,{value:"hafalan",className:"mt-6",children:(0,a.jsx)(K,{entries:s,type:"hafalan",onProgressUpdated:l,onDuplicateEntry:e=>h("hafalan",e)})}),(0,a.jsx)(Q,{value:"tilawah",className:"mt-6",children:(0,a.jsx)(K,{entries:t,type:"tilawah",onProgressUpdated:l,onDuplicateEntry:e=>h("tilawah",e)})})]})})]})},el=t(28270);let en=e=>{let{profile:s}=(0,E.a)(),[t,a]=(0,r.useState)(null),[l,n]=(0,r.useState)({hafalan_progress:null,tilawah_progress:null}),[i,d]=(0,r.useState)([]),[c,o]=(0,r.useState)([]),[h,x]=(0,r.useState)(!0),u=async()=>{try{if(!e||!s){a(null);return}let{data:t,error:r}=await D.O.from("students").select("*").eq("id",e).maybeSingle();if(r)throw r;if(!t){a(null);return}a(t)}catch(e){console.error("Error fetching student data:",e),a(null)}finally{x(!1)}},m=async()=>{try{if(!t||!e)return;let{data:a,error:r}=await D.O.from("progress_entries").select("*").eq("student_id",e).order("date",{ascending:!1});if(r)throw r;let l=(null==a?void 0:a.filter(e=>"hafalan"===e.type))||[],i=(null==a?void 0:a.filter(e=>"tilawah"===e.type))||[];d(l),o(i);let c=(0,el.B)(l),h=(0,el.L)(i);n({hafalan_progress:c.percentage>0?c:null,tilawah_progress:h.percentage>0?h:null}),(null==s?void 0:s.role)==="teacher"&&(l.length>0&&e&&await D.O.from("hafalan_progress").upsert({student_id:e,percentage:c.percentage,last_surah:c.last_surah,updated_at:new Date().toISOString()}),i.length>0&&e&&await D.O.from("tilawah_progress").upsert({student_id:e,percentage:h.percentage,jilid:h.jilid,updated_at:new Date().toISOString()}))}catch(e){console.error("Error fetching progress entries:",e)}};return(0,r.useEffect)(()=>{e&&u()},[e,s]),(0,r.useEffect)(()=>{t&&m()},[t]),{student:t,progressData:l,hafalanEntries:i,tilawahEntries:c,loading:h,refetchData:()=>{u(),m()}}};var ei=t(91560),ed=t(96657),ec=()=>{let e=(0,l.useParams)(),s=null==e?void 0:e.id,t=(0,l.useRouter)(),{profile:r}=(0,E.a)(),{student:i,progressData:c,hafalanEntries:o,tilawahEntries:h,loading:x,refetchData:u}=en(s);if(x)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-islamic-500"})});if(!i)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"container mx-auto px-6 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Student Not Found"}),(0,a.jsx)(n.z,{onClick:()=>t.back(),children:"Back"})]})})});let m=[{label:"Dashboard",href:"/dashboard"},{label:i.group_name,href:"/class/".concat(encodeURIComponent(i.group_name))},{label:i.name}],g=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{student:{...i,grade:i.grade||"Unknown"},userRole:(null==r?void 0:r.role)||"parent",profile:r||void 0}),(0,a.jsx)(q,{student:i,progressData:c,onProgressAdded:u,onStudentUpdated:u,onStudentDeleted:()=>{t.push("/dashboard")}}),(0,a.jsx)(er,{hafalanEntries:o,tilawahEntries:h,onProgressUpdated:u,studentId:i.id})]});return(null==r?void 0:r.role)==="parent"?(0,a.jsx)(ed.Z,{breadcrumbs:m,children:g}):(0,a.jsx)(ei.Z,{breadcrumbs:m,children:g})},eo=t(48223);function eh(){return(0,a.jsx)(eo.Z,{children:(0,a.jsx)(ec,{})})}},39079:function(e,s,t){"use strict";var a=t(57437),r=t(2265),l=t(12381),n=t(32489),i=t(17689),d=t(93448);s.Z=e=>{let{onFileSelect:s,currentImage:t,className:c}=e,o=(0,r.useRef)(null),[h,x]=(0,r.useState)(t||null);return(0,a.jsxs)("div",{className:(0,d.cn)("space-y-2",c),children:[(0,a.jsx)("input",{ref:o,type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=e=>{var s;x(null===(s=e.target)||void 0===s?void 0:s.result)},e.readAsDataURL(a),s(a)}},className:"hidden"}),h?(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("img",{src:h,alt:"Preview",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-200"}),(0,a.jsx)(l.z,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 p-0 rounded-full",onClick:()=>{x(null),s(null),o.current&&(o.current.value="")},children:(0,a.jsx)(n.Z,{className:"h-3 w-3"})})]}):(0,a.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},className:"w-20 h-20 rounded-full border-dashed",children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})]})}}},function(e){e.O(0,[1425,2505,3621,8977,8925,2426,5289,8092,3486,2804,9528,8887,5880,2971,2117,1744],function(){return e(e.s=10357)}),_N_E=e.O()}]);