(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8650],{26671:function(e,s,t){Promise.resolve().then(t.bind(t,72491))},72491:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return M}});var l=t(57437),a=t(2265),r=t(29827),i=t(11713),n=t(92451),d=t(99397),c=t(88455),u=t(23340),o=t(74291),h=t(12381),x=t(40279),m=t(75060),v=t(15291),j=t(23675),f=t(53528),p=t(5526);let g=async e=>{try{console.log("Fetching tests with filters:",e);let s=p.O.from("tilawati_level_tests").select("*").order("date",{ascending:!1});e.status&&"all"!==e.status&&Array.isArray(e.status)&&e.status.length>0?s=1===e.status.length?s.eq("status",e.status[0]):s.in("status",e.status):e.status&&"all"!==e.status&&"string"==typeof e.status&&(s=s.eq("status",e.status)),e.jilidLevel&&"all"!==e.jilidLevel&&Array.isArray(e.jilidLevel)&&e.jilidLevel.length>0?s=1===e.jilidLevel.length?s.eq("tilawati_level",e.jilidLevel[0]):s.in("tilawati_level",e.jilidLevel):e.jilidLevel&&"all"!==e.jilidLevel&&"string"==typeof e.jilidLevel&&(s=s.eq("tilawati_level",e.jilidLevel)),e.searchTerm&&(s=s.ilike("class_name","%".concat(e.searchTerm,"%"))),e.date&&(s=s.eq("date",e.date));let{data:t,error:l}=await s;if(l)throw console.error("Error fetching tests with filters:",l),l;return console.log("Fetched tests:",t),t||[]}catch(e){throw console.error("Error in fetchTestsWithFilters:",e),e}},y=async(e,s)=>{try{if(s){let{data:t,error:l}=await p.O.from("tilawati_level_tests").update(e).eq("id",s).select().single();if(l)throw console.error("Error updating test:",l),l;return t}{let{data:s,error:t}=await p.O.from("tilawati_level_tests").insert([e]).select().single();if(t)throw console.error("Error creating test:",t),t;return s}}catch(e){throw console.error("Error in saveTest:",e),e}},b=async e=>{if(!e)throw Error("Test ID is required");try{let{error:s}=await p.O.from("tilawati_level_tests").delete().eq("id",e);if(s)throw console.error("Error deleting test:",s),Error(s.message)}catch(e){throw console.error("Error in deleteTest:",e),e}},w=["Level 1","Level 2","Level 3","Level 4","Level 5","Level 6"],N=["scheduled","passed","failed"];var _=e=>{let{isOpen:s,onClose:t,onTestAddedOrUpdated:r,students:i,currentTest:n}=e,{profile:d}=(0,f.a)(),[u,p]=(0,a.useState)(""),[g,b]=(0,a.useState)(""),[_,C]=(0,a.useState)(""),[S,L]=(0,a.useState)(""),[T,q]=(0,a.useState)((null==d?void 0:d.full_name)||""),[I,k]=(0,a.useState)("scheduled"),[E,F]=(0,a.useState)(""),[O,z]=(0,a.useState)(!1),[J,A]=(0,a.useState)(null);(0,a.useEffect)(()=>{n?(p(n.student_id),b(n.class_name||""),C(n.tilawati_level),L(n.date?new Date(n.date).toISOString().substring(0,10):""),q(n.munaqisy),k(n.status),F(n.notes||"")):(p(""),b(""),C(""),L(""),q((null==d?void 0:d.full_name)||""),k("scheduled"),F(""))},[n,s,null==d?void 0:d.full_name]),(0,a.useEffect)(()=>{if(u&&!n){let e=i.find(e=>e.id===u);(null==e?void 0:e.class_name)&&b(e.class_name),(null==e?void 0:e.current_tilawati_jilid)&&C(e.current_tilawati_jilid)}},[u,i,n]);let D=async e=>{if(e.preventDefault(),z(!0),A(null),!u||!_||!S||!T||!g){A("All required fields must be filled."),z(!1);return}try{let e=await y({student_id:u,class_name:g,tilawati_level:_,date:S,munaqisy:T,status:I,notes:E||""},null==n?void 0:n.id);r(e),t()}catch(e){console.error("Error saving test:",e),A(e instanceof Error?e.message:"An unexpected error occurred.")}finally{z(!1)}},Z=i.find(e=>e.id===u);return(0,l.jsx)(o.Vq,{open:s,onOpenChange:e=>!e&&t(),children:(0,l.jsxs)(o.cZ,{className:"sm:max-w-[525px] bg-white flex flex-col h-[calc(100vh-32px)] sm:h-auto max-h-[calc(100vh-32px)] p-0","aria-describedby":"add-test-description",children:[(0,l.jsxs)(o.fK,{className:"px-6 pt-6 flex-shrink-0",children:[(0,l.jsx)(o.$N,{children:n?"Edit Tilawati Test":"Schedule Tilawati Test"}),(0,l.jsx)(o.Be,{id:"add-test-description",children:n?"Edit test details below.":"Fill in the Tilawati test details for the student."})]}),(0,l.jsxs)("form",{onSubmit:D,className:"flex flex-col min-h-0 flex-1",children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto px-6",children:[(0,l.jsxs)("div",{className:"space-y-4 py-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"student",children:"Student"}),(0,l.jsxs)(v.Ph,{value:u,onValueChange:p,disabled:!!n,children:[(0,l.jsx)(v.i4,{id:"student",children:(0,l.jsx)(v.ki,{placeholder:"Select Student"})}),(0,l.jsx)(v.Bw,{children:i.map(e=>(0,l.jsxs)(v.Ql,{value:e.id,children:[e.name," ",e.class_name?"(".concat(e.class_name,")"):""," - ",e.current_tilawati_jilid]},e.id))})]}),u&&(0,l.jsxs)("div",{className:"text-sm mt-1",children:[(0,l.jsx)("p",{className:"text-green-600",children:"âœ… Student has completed their current level and is ready for testing"}),Z&&(0,l.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Teacher: ",Z.teacher]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"className",children:"Class Name"}),(0,l.jsx)(x.I,{id:"className",value:g,onChange:e=>b(e.target.value),placeholder:"Class Name"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"tilawatiLevel",children:"Tilawati Level"}),(0,l.jsxs)(v.Ph,{value:_,onValueChange:e=>C(e),children:[(0,l.jsx)(v.i4,{id:"tilawatiLevel",children:(0,l.jsx)(v.ki,{placeholder:"Select Tilawati Level"})}),(0,l.jsx)(v.Bw,{children:w.map(e=>(0,l.jsx)(v.Ql,{value:e,children:e},e))})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"testDate",children:"Test Date"}),(0,l.jsx)(x.I,{id:"testDate",type:"date",value:S,onChange:e=>L(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"munaqisy",children:"Examiner"}),(0,l.jsx)(x.I,{id:"munaqisy",value:T,onChange:e=>q(e.target.value),placeholder:"Examiner Name"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"status",children:"Status"}),(0,l.jsxs)(v.Ph,{value:I,onValueChange:e=>k(e),children:[(0,l.jsx)(v.i4,{id:"status",children:(0,l.jsx)(v.ki,{placeholder:"Select Status"})}),(0,l.jsx)(v.Bw,{children:N.map(e=>(0,l.jsx)(v.Ql,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m._,{htmlFor:"notes",children:"Notes"}),(0,l.jsx)(j.g,{id:"notes",value:E,onChange:e=>F(e.target.value),placeholder:"Add notes if needed...",className:"h-20"})]})]}),J&&(0,l.jsx)("div",{className:"text-sm font-medium text-red-500 mt-2 mb-4",children:J})]}),(0,l.jsx)(o.cN,{className:"px-6 py-4 bg-gray-50 border-t mt-auto flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex justify-end gap-4 w-full",children:[(0,l.jsx)(o.GG,{asChild:!0,children:(0,l.jsx)(h.z,{variant:"outline",onClick:t,children:"Cancel"})}),(0,l.jsx)(c.O,{type:"submit",disabled:O,children:O?"Saving...":n?"Save Changes":"Add Test"})]})})]})]})})},C=t(91560),S=t(17938),L=t(64014),T=t(33804),q=t(69174),I=t(42208),k=t(15868),E=e=>{let{test:s,onTestUpdated:t}=e,[r,i]=(0,a.useState)(!1),[n,d]=(0,a.useState)(!1),[c,f]=(0,a.useState)({student_id:s.student_id,class_name:s.class_name,tilawati_level:s.tilawati_level,date:s.date,munaqisy:s.munaqisy,status:s.status,notes:s.notes||""}),{toast:g}=(0,u.pm)(),y=async e=>{e.preventDefault(),d(!0);try{let{error:e}=await p.O.from("tilawati_level_tests").update(c).eq("id",s.id);if(e)throw e;g({title:"Success",description:"Test updated successfully!"}),i(!1),t()}catch(e){console.error("Error updating test:",e),g({title:"Error",description:"Failed to update test. Please try again.",variant:"destructive"})}finally{d(!1)}},b=(e,s)=>{f(t=>({...t,[e]:s}))};return(0,l.jsxs)(o.Vq,{open:r,onOpenChange:i,children:[(0,l.jsx)(o.hg,{asChild:!0,children:(0,l.jsx)(h.z,{variant:"ghost",size:"sm",children:(0,l.jsx)(k.Z,{className:"h-4 w-4"})})}),(0,l.jsxs)(o.cZ,{className:"sm:max-w-[425px]","aria-describedby":"edit-test-description",children:[(0,l.jsxs)(o.fK,{children:[(0,l.jsx)(o.$N,{children:"Edit Test"}),(0,l.jsx)(o.Be,{id:"edit-test-description",children:"Update the test details for this student."})]}),(0,l.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m._,{htmlFor:"date",children:"Test Date"}),(0,l.jsx)(x.I,{id:"date",type:"date",value:c.date,onChange:e=>b("date",e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m._,{htmlFor:"tilawati_level",children:"Target Level"}),(0,l.jsxs)(v.Ph,{value:c.tilawati_level,onValueChange:e=>b("tilawati_level",e),children:[(0,l.jsx)(v.i4,{children:(0,l.jsx)(v.ki,{placeholder:"Select target level"})}),(0,l.jsxs)(v.Bw,{children:[(0,l.jsx)(v.Ql,{value:"Jilid 1",children:"Jilid 1"}),(0,l.jsx)(v.Ql,{value:"Jilid 2",children:"Jilid 2"}),(0,l.jsx)(v.Ql,{value:"Jilid 3",children:"Jilid 3"}),(0,l.jsx)(v.Ql,{value:"Jilid 4",children:"Jilid 4"}),(0,l.jsx)(v.Ql,{value:"Jilid 5",children:"Jilid 5"}),(0,l.jsx)(v.Ql,{value:"Jilid 6",children:"Jilid 6"}),(0,l.jsx)(v.Ql,{value:"Al-Quran",children:"Al-Quran"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m._,{htmlFor:"munaqisy",children:"Examiner"}),(0,l.jsx)(x.I,{id:"munaqisy",value:c.munaqisy,onChange:e=>b("munaqisy",e.target.value),placeholder:"Examiner name",required:!0})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m._,{htmlFor:"status",children:"Status"}),(0,l.jsxs)(v.Ph,{value:c.status,onValueChange:e=>b("status",e),children:[(0,l.jsx)(v.i4,{children:(0,l.jsx)(v.ki,{placeholder:"Select test status"})}),(0,l.jsxs)(v.Bw,{children:[(0,l.jsx)(v.Ql,{value:"scheduled",children:"Scheduled"}),(0,l.jsx)(v.Ql,{value:"passed",children:"Passed"}),(0,l.jsx)(v.Ql,{value:"failed",children:"Failed"}),(0,l.jsx)(v.Ql,{value:"pending_retake",children:"Pending Retake"}),(0,l.jsx)(v.Ql,{value:"cancelled",children:"Cancelled"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m._,{htmlFor:"notes",children:"Notes"}),(0,l.jsx)(j.g,{id:"notes",value:c.notes,onChange:e=>b("notes",e.target.value),placeholder:"Additional notes...",rows:3})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)(h.z,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,l.jsx)(h.z,{type:"submit",disabled:n,children:n?"Updating...":"Update Test"})]})]})]})]})},F=t(18930),O=t(30767),z=e=>{let{testId:s,onTestDeleted:t}=e,{toast:a}=(0,u.pm)(),i=(0,r.NL)(),n=async()=>{try{await b(s),await i.invalidateQueries({queryKey:["tilawati-tests"]}),a({title:"Success",description:"Test deleted successfully!"}),t&&t()}catch(e){console.error("Error deleting test:",e),a({title:"Error",description:"Failed to delete test. Please try again.",variant:"destructive"})}};return(0,l.jsxs)(O.aR,{children:[(0,l.jsx)(O.vW,{asChild:!0,children:(0,l.jsx)(h.z,{variant:"ghost",size:"sm",children:(0,l.jsx)(F.Z,{className:"h-4 w-4"})})}),(0,l.jsxs)(O._T,{children:[(0,l.jsxs)(O.fY,{children:[(0,l.jsx)(O.f$,{children:"Delete Test"}),(0,l.jsx)(O.yT,{children:"Are you sure you want to delete this test? This action cannot be undone."})]}),(0,l.jsxs)(O.xo,{children:[(0,l.jsx)(O.le,{children:"Cancel"}),(0,l.jsx)(O.OL,{onClick:n,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})},J=e=>{let{tests:s,isLoading:t,onTestUpdated:a,showStudentName:r=!1,getStudentName:i}=e,n=e=>(0,l.jsx)(q.C,{className:{scheduled:"bg-blue-100 text-blue-800",passed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",pending_retake:"bg-yellow-100 text-yellow-800",cancelled:"bg-gray-100 text-gray-800"}[e],children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}),d=e=>{alert("Test Details:\nStudent: ".concat(i?i(e.student_id):e.student_id,"\nDate: ").concat((0,L.WU)(new Date(e.date),"dd/MM/yyyy"),"\nClass: ").concat(e.class_name||"-","\nLevel: ").concat(e.tilawati_level,"\nMunaqisy: ").concat(e.munaqisy,"\nStatus: ").concat(e.status,"\nNotes: ").concat(e.notes||"No notes"))};return t?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(()=>(0,l.jsx)("div",{className:"space-y-4 md:hidden",children:s.map(e=>(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 space-y-3",children:[r&&(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:i?i(e.student_id):e.student_id}),n(e.status)]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Class"}),(0,l.jsx)("p",{className:"font-medium",children:e.class_name||"-"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Level"}),(0,l.jsx)("p",{className:"font-medium",children:e.tilawati_level})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Date"}),(0,l.jsx)("p",{className:"font-medium",children:(0,L.WU)(new Date(e.date),"dd/MM/yyyy")})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Examiner"}),(0,l.jsx)("p",{className:"font-medium",children:e.munaqisy})]})]}),e.notes&&(0,l.jsxs)("div",{className:"border-t pt-2",children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Notes"}),(0,l.jsx)("p",{className:"text-sm",children:e.notes})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[(0,l.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>d(e),children:(0,l.jsx)(I.Z,{className:"h-4 w-4"})}),(0,l.jsx)(E,{test:e,onTestUpdated:a}),(0,l.jsx)(z,{testId:e.id,onTestDeleted:a})]})]},e.id))}),{}),(0,l.jsx)(()=>(0,l.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,l.jsxs)(T.iA,{children:[(0,l.jsx)(T.xD,{children:(0,l.jsxs)(T.SC,{children:[r&&(0,l.jsx)(T.ss,{children:"Student Name"}),(0,l.jsx)(T.ss,{children:"Class"}),(0,l.jsx)(T.ss,{children:"Tilawati Level"}),(0,l.jsx)(T.ss,{children:"Date"}),(0,l.jsx)(T.ss,{children:"Examiner"}),(0,l.jsx)(T.ss,{children:"Status"}),(0,l.jsx)(T.ss,{children:"Notes"}),(0,l.jsx)(T.ss,{className:"text-right",children:"Actions"})]})}),(0,l.jsx)(T.RM,{children:s.map(e=>(0,l.jsxs)(T.SC,{children:[r&&(0,l.jsx)(T.pj,{children:i?i(e.student_id):e.student_id}),(0,l.jsx)(T.pj,{children:e.class_name||"-"}),(0,l.jsx)(T.pj,{children:e.tilawati_level}),(0,l.jsx)(T.pj,{children:(0,L.WU)(new Date(e.date),"dd/MM/yyyy")}),(0,l.jsx)(T.pj,{children:e.munaqisy}),(0,l.jsx)(T.pj,{children:n(e.status)}),(0,l.jsx)(T.pj,{children:e.notes||"-"}),(0,l.jsx)(T.pj,{className:"text-right",children:(0,l.jsxs)("div",{className:"flex justify-end space-x-1",children:[(0,l.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>d(e),children:(0,l.jsx)(I.Z,{className:"h-4 w-4"})}),(0,l.jsx)(E,{test:e,onTestUpdated:a}),(0,l.jsx)(z,{testId:e.id,onTestDeleted:a})]})})]},e.id))})]})}),{})]})},A=t(28270),D=t(99376),Z=()=>{let e=(0,D.useRouter)(),{profile:s}=(0,f.a)(),{toast:t}=(0,u.pm)(),o=(0,r.NL)(),[h,x]=(0,a.useState)(!1),[m,v]=(0,a.useState)(null),[j,y]=(0,a.useState)({status:[],jilidLevel:[]}),{data:b,refetch:w}=(0,i.a)({queryKey:["teacher-students",null==s?void 0:s.id],queryFn:async()=>{if(!(null==s?void 0:s.id))return[];let{data:e,error:t}=await p.O.from("students").select("\n          id,\n          name,\n          group_name,\n          grade,\n          teacher,\n          photo\n        ").order("name");if(t)throw console.error("Error fetching students:",t),t;return e&&0!==e.length?(await Promise.all(e.map(async e=>{try{let{data:s,error:t}=await p.O.from("progress_entries").select("*").eq("student_id",e.id).eq("type","tilawah").order("date",{ascending:!1});if(t)return console.error("Error fetching tilawah entries for student ".concat(e.id,":"),t),null;let l=(0,A.L)(s||[]);if(100!==l.percentage)return null;return{id:e.id,name:e.name,current_tilawati_jilid:l.jilid||"Jilid 1",class_name:e.group_name||"",teacher:e.teacher,progress_percentage:l.percentage,is_eligible_for_test:!0}}catch(s){return console.error("Error processing student ".concat(e.id,":"),s),null}}))).filter(e=>null!==e):[]},enabled:!!(null==s?void 0:s.id)}),{data:N,isLoading:L}=(0,i.a)({queryKey:["tilawati-tests",j],queryFn:()=>g(j),enabled:!!(null==s?void 0:s.id),staleTime:0,gcTime:0,refetchOnMount:!0,refetchOnWindowFocus:!0}),T=()=>{o.invalidateQueries({queryKey:["tilawati-tests"]}),w(),t({title:"Success",description:"Test data has been updated successfully."})};return(0,l.jsx)(C.Z,{breadcrumbs:[{label:"Dashboard",href:"/dashboard"},{label:"Tilawati Tests"}],children:(0,l.jsxs)("div",{className:"container mx-auto px-0 md:px-6 md:py-6",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 w-full mb-6",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center gap-3 sm:gap-4 mt-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>e.push("/dashboard"),className:"p-0 m-0 bg-transparent border-none outline-none flex items-center","aria-label":"Back",children:(0,l.jsx)(n.Z,{className:"h-6 w-6"})}),(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Tilawati Tests"})]}),(0,l.jsxs)(c.O,{onClick:()=>x(!0),className:"w-full md:w-auto",children:[(0,l.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Schedule Test"]})]}),(0,l.jsx)(S.Z,{searchTerm:j.searchTerm,status:j.status,jilidLevel:j.jilidLevel,date:j.date,onFilterChange:(e,s)=>{y(t=>({...t,[e]:s}))},showDateFilter:!0}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,l.jsx)(J,{tests:N||[],isLoading:L,onTestUpdated:T,showStudentName:!0,getStudentName:e=>{let s=null==b?void 0:b.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown Student"}})}),h&&(0,l.jsx)(_,{isOpen:h,onClose:()=>{x(!1),v(null)},onTestAddedOrUpdated:T,currentTest:m,students:b||[]})]})})},Q=t(48223);function M(){return(0,l.jsx)(Q.Z,{requiredRole:"teacher",children:(0,l.jsx)(Z,{})})}},17938:function(e,s,t){"use strict";var l=t(57437),a=t(2265),r=t(73247),i=t(90740),n=t(40279),d=t(68245);let c=[{value:"scheduled",label:"Scheduled"},{value:"passed",label:"Passed"},{value:"failed",label:"Failed"}],u=[{value:"Level 1",label:"Level 1"},{value:"Level 2",label:"Level 2"},{value:"Level 3",label:"Level 3"},{value:"Level 4",label:"Level 4"},{value:"Level 5",label:"Level 5"},{value:"Level 6",label:"Level 6"}];s.Z=e=>{let{searchTerm:s="",status:t=[],jilidLevel:o=[],date:h,onFilterChange:x,showDateFilter:m=!1}=e,[v,j]=(0,a.useState)(!1),f=t&&t.length>0||o&&o.length>0||h;return(0,l.jsxs)("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg border border-gray-200 mb-6 px-0 sm:px-0",children:[(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"relative w-full mb-4",children:[(0,l.jsx)(r.Z,{className:"absolute left-3 top-2.5 h-4 w-4 text-blue-400"}),(0,l.jsx)(n.I,{placeholder:"Search students by name...",value:s,onChange:e=>x("searchTerm",e.target.value),className:"pl-9 pr-4 w-full bg-blue-50 border border-blue-200 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-100 text-base py-2 shadow-sm"})]}),(0,l.jsxs)("button",{className:"w-full flex items-center gap-3 px-0 py-3 border-b border-gray-100 hover:bg-gray-50 focus:outline-none",onClick:()=>j(e=>!e),"aria-expanded":v,children:[(0,l.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,l.jsx)(i.Z,{className:"h-4 w-4 text-gray-600"})}),(0,l.jsxs)("div",{className:"flex-1 text-left",children:[(0,l.jsx)("h3",{className:"font-semibold text-gray-900 text-base sm:text-lg",children:"Filters"}),(0,l.jsx)("p",{className:"text-xs sm:text-sm text-gray-500",children:"Refine your search results"}),f&&(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mt-2",children:[t.length>0&&(0,l.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 sm:px-3 sm:py-1 bg-blue-50 text-blue-700 text-xs sm:text-sm rounded-full border border-blue-200",children:["Status: ",t.map(e=>{var s;return(null===(s=c.find(s=>s.value===e))||void 0===s?void 0:s.label)||e}).join(", ")]}),o.length>0&&(0,l.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 sm:px-3 sm:py-1 bg-blue-50 text-blue-700 text-xs sm:text-sm rounded-full border border-blue-200",children:["Level: ",o.map(e=>{var s;return(null===(s=u.find(s=>s.value===e))||void 0===s?void 0:s.label)||e}).join(", ")]}),(0,l.jsx)("button",{type:"button",onClick:()=>{x("searchTerm",""),x("status",[]),x("jilidLevel",[]),m&&x("date",void 0)},className:"ml-2 text-xs text-gray-500 hover:text-red-600 underline",children:"Clear Filters"})]})]}),(0,l.jsx)("span",{className:"ml-auto text-xs text-gray-500",children:v?"Hide":"Show"})]})]}),v&&(0,l.jsx)("div",{className:"p-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6",children:[(0,l.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,l.jsxs)("label",{className:"text-xs sm:text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Status"]}),(0,l.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:c.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(d.X,{id:"status-filter-".concat(e.value),checked:t.includes(e.value),onCheckedChange:()=>{x("status",t.includes(e.value)?t.filter(s=>s!==e.value):[...t,e.value])},className:"rounded-full"}),(0,l.jsx)("label",{htmlFor:"status-filter-".concat(e.value),className:"text-sm text-gray-700 cursor-pointer",children:e.label})]},e.value))})]}),(0,l.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,l.jsxs)("label",{className:"text-xs sm:text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Level"]}),(0,l.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(d.X,{id:"jilid-filter-".concat(e.value),checked:o.includes(e.value),onCheckedChange:()=>{x("jilidLevel",o.includes(e.value)?o.filter(s=>s!==e.value):[...o,e.value])},className:"rounded-full"}),(0,l.jsx)("label",{htmlFor:"jilid-filter-".concat(e.value),className:"text-sm text-gray-700 cursor-pointer",children:e.label})]},e.value))})]})]})})]})}},96246:function(e,s,t){"use strict";t.d(s,{F$:function(){return d},Q5:function(){return c},qE:function(){return n}});var l=t(57437),a=t(2265),r=t(61146),i=t(93448);let n=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.fC,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});n.displayName=r.fC.displayName;let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.Ee,{ref:s,className:(0,i.cn)("aspect-square h-full w-full",t),...a})});d.displayName=r.Ee.displayName;let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.NY,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})});c.displayName=r.NY.displayName},12381:function(e,s,t){"use strict";t.d(s,{d:function(){return d},z:function(){return c}});var l=t(57437),a=t(2265),r=t(37053),i=t(90535),n=t(93448);let d=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 px-3",lg:"h-11 px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,s)=>{let{className:t,variant:a,size:i,asChild:c=!1,...u}=e,o=c?r.g7:"button";return(0,l.jsx)(o,{className:(0,n.cn)(d({variant:a,size:i,className:t})),ref:s,...u})});c.displayName="Button"},68245:function(e,s,t){"use strict";t.d(s,{X:function(){return d}});var l=t(57437),a=t(2265),r=t(9270),i=t(30401),n=t(93448);let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.fC,{ref:s,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...a,children:(0,l.jsx)(r.z$,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(i.Z,{className:"h-4 w-4"})})})});d.displayName=r.fC.displayName},14362:function(e,s,t){"use strict";t.d(s,{H:function(){return n},V:function(){return i}});var l=t(57437),a=t(2265),r=t(1072);let i=(0,a.createContext)(void 0),n=e=>{let{children:s}=e,[t,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[u,o]=(0,a.useState)(null),[h,x]=(0,a.useState)(!0),m=async e=>{try{let{data:s,error:t}=await r.O.from("profiles").select("*").eq("id",e).single();if(t)console.error("Error fetching profile:",t);else if(s){let e={id:s.id,full_name:s.full_name,role:s.role,email:s.email,avatar_url:s.avatar_url,created_at:s.created_at,updated_at:s.updated_at};o(e)}}catch(e){console.error("Error in profile fetch:",e)}};(0,a.useEffect)(()=>{let{data:{subscription:e}}=r.O.auth.onAuthStateChange(async(e,s)=>{var t;console.log("Auth state changed:",e,s),c(s),n(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),(null==s?void 0:s.user)?setTimeout(async()=>{await m(s.user.id),x(!1)},0):(o(null),x(!1))});return r.O.auth.getSession().then(e=>{var s;let{data:{session:t}}=e;c(t),n(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),t||x(!1)}),()=>e.unsubscribe()},[]);let v=async()=>{t&&await m(t.id)},j=async(e,s)=>{let{data:t,error:l}=await r.O.auth.signInWithPassword({email:e,password:s});return{data:t,error:l}},f=async(e,s,t,l)=>{let{data:a,error:i}=await r.O.auth.signUp({email:e,password:s,options:{data:{full_name:t,role:l}}});if(a.user&&!i)try{await g(a.user,l)}catch(e){return console.error("Error creating profile:",e),await r.O.auth.admin.deleteUser(a.user.id),{data:{user:null,session:null},error:e}}return{data:a,error:i}},p=async()=>{try{let{error:e}=await r.O.auth.signOut();if(e)throw e;return n(null),c(null),o(null),{error:null}}catch(e){return console.error("Error signing out:",e),{error:e}}},g=async(e,s)=>{let{data:t,error:l}=await r.O.from("profiles").insert([{id:e.id,full_name:e.user_metadata.full_name||"",role:s,email:e.email||void 0,avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(l)throw console.error("Error creating profile:",l),l;return t};return(0,l.jsx)(i.Provider,{value:{user:t,session:d,profile:u,loading:h,signIn:j,signUp:f,signOut:p,refreshProfile:v},children:s})}},53528:function(e,s,t){"use strict";t.d(s,{a:function(){return r}});var l=t(2265),a=t(14362);let r=()=>{let e=(0,l.useContext)(a.V);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1072:function(e,s,t){"use strict";t.d(s,{O:function(){return l}});let l=(0,t(96580).eI)("https://isyhakwwgdozgtlquzis.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzeWhha3d3Z2Rvemd0bHF1emlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NTY3NzcsImV4cCI6MjA2MjUzMjc3N30.-2Ya944q8mgJzRAuhMpRAWgxWVmt2yc3CqM0jjgFuuY")},5526:function(e,s,t){"use strict";t.d(s,{O:function(){return l}});let l=(0,t(96580).eI)("https://isyhakwwgdozgtlquzis.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzeWhha3d3Z2Rvemd0bHF1emlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NTY3NzcsImV4cCI6MjA2MjUzMjc3N30.-2Ya944q8mgJzRAuhMpRAWgxWVmt2yc3CqM0jjgFuuY",{db:{schema:"public"}})},93448:function(e,s,t){"use strict";t.d(s,{cn:function(){return r}});var l=t(61994),a=t(53335);function r(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,l.W)(s))}}},function(e){e.O(0,[3621,8977,8925,5289,9763,8092,908,6669,9528,5880,2971,2117,1744],function(){return e(e.s=26671)}),_N_E=e.O()}]);